<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Video Script Generator</title>

<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .container {
    background: #111;
    padding: 25px;
    width: 100%;
    max-width: 420px;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.5);
  }

  h1 {
    text-align: center;
    margin-bottom: 20px;
  }

  label {
    font-size: 14px;
    margin-top: 12px;
    display: block;
  }

  input, select {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border-radius: 6px;
    border: none;
    outline: none;
  }

  button {
    width: 100%;
    margin-top: 20px;
    padding: 12px;
    background: #00c6ff;
    border: none;
    border-radius: 6px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
  }

  button:hover {
    background: #009edc;
  }

  .status {
    text-align: center;
    margin-top: 15px;
    font-size: 14px;
  }
</style>
</head>

<body>
<div id="loginBox">
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="signup()">Sign Up</button>
  <button onclick="login()">Login</button>
</div>
<div class="container">
  <h1>AI Video Generator</h1>

  <form id="aiForm">

    <label>Topic</label>
    <input id="topic" required placeholder="Enter video topic">

    <label>Video Type</label>
    <select id="videoType" required>
      <option value="Short">Short</option>
      <option value="Long">Long</option>
    </select>

    <label>Tone</label>
    <input id="tone" placeholder="Friendly, Professional, etc">

    <label>Generate Image?</label>
    <select id="generateImage">
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>

    <label>Number of Images</label>
    <input id="imageCount" type="number" min="1" max="5">

    <button type="submit">Generate</button>
  </form>

  <div class="status" id="status"></div>
</div>

<script>
<script type="module">
// ========================
// Firebase Setup
// ========================
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCwumS1PZH4aKpKBMhmDiNXMyp9zgPm0JY",
  authDomain: "ai-video-generator-562af.firebaseapp.com",
  projectId: "ai-video-generator-562af",
  storageBucket: "ai-video-generator-562af.firebasestorage.app",
  messagingSenderId: "299293689534",
  appId: "1:299293689534:web:3a62b8233ff0b02401c0ef"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// ========================
// Signup Function
// ========================
window.signup = function() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  createUserWithEmailAndPassword(auth, email, password)
    .then(() => alert("Account created successfully ✅"))
    .catch(err => alert(err.message));
};

// ========================
// Login Function
// ========================
window.login = function() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  signInWithEmailAndPassword(auth, email, password)
    .then(() => alert("Logged in successfully ✅"))
    .catch(err => alert(err.message));
};

// ========================
// Show/Hide Login & AI Form
// ========================
onAuthStateChanged(auth, user => {
  const loginBox = document.getElementById("loginBox");
  const aiContainer = document.querySelector(".container");

  if (user) {
    loginBox.style.display = "none";
    aiContainer.style.display = "block";
  } else {
    loginBox.style.display = "block";
    aiContainer.style.display = "none";
  }
});

// ========================
// AI Form Submission
// ========================
document.getElementById("aiForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const currentUser = auth.currentUser;
  if (!currentUser) {
    alert("⚠️ Please log in first to use this feature.");
    return; // Stop submission if not logged in
  }

  const statusEl = document.getElementById("status");
  statusEl.innerText = "Sending to AI...";

  const payload = {
    topic: document.getElementById("topic").value,
    video_type: document.getElementById("videoType").value,
    tone: document.getElementById("tone").value,
    generate_image: document.getElementById("generateImage").value,
    image_count: document.getElementById("imageCount").value,
    user_id: currentUser.uid
  };

  console.log("Payload to AI:", payload);

  fetch("https://hooks.zapier.com/hooks/catch/26044546/ugc49fb/", {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  statusEl.innerText = "Request sent successfully ✅";
});

// ========================
// Google Sheet Fetch & Display Results
// ========================
const sheetURL = "https://spreadsheets.google.com/feeds/list/2PACX-1vS9GDPobHDyoNMlFaY2_sXsBUYLoFtugV337QnsZ1_peM1AzNYZc5-dcKsl8OZ4y8Zh0afqdnYgbV1T/od6/public/values?alt=json";

async function fetchSheetData() {
  try {
    const response = await fetch(sheetURL);
    const data = await response.json();

    const entries = data.feed.entry;
    const results = entries.map(item => ({
      topic: item.gsx$topic.$t,
      video_type: item.gsx$videotype.$t,
      tone: item.gsx$tone.$t,
      script: item.gsx$script?.$t || "Not ready",
      voiceover_script: item.gsx$voiceoverscript?.$t || "Not ready",
      image_prompt: item.gsx$imageprompt?.$t || "N/A",
      generate_image: item.gsx$generateimage?.$t || "No",
      image_count: item.gsx$numberofimages?.$t || 0,
      user_id: item.gsx$userid.$t,
      timestamp: item.gsx$timestamp.$t,
      status: item.gsx$status?.$t || "Pending"
    }));

    return results;

  } catch (err) {
    console.error("Error fetching sheet data:", err);
    return [];
  }
}

// ========================
// Check Result Button
// ========================
document.getElementById("checkResultBtn").addEventListener("click", async function() {
  const currentUser = auth.currentUser;
  if (!currentUser) {
    alert("⚠️ Please log in first to use this feature.");
    return;
  }

  const userId = currentUser.uid;
  const resultDiv = document.getElementById("result");

  resultDiv.innerText = "Fetching result...";

  const allData = await fetchSheetData();
  const userData = allData.find(row => row.user_id === userId);

  if (userData) {
    resultDiv.innerHTML = `
      <b>Topic:</b> ${userData.topic} <br>
      <b>Video Type:</b> ${userData.video_type} <br>
      <b>Tone:</b> ${userData.tone} <br>
      <b>Script:</b> ${userData.script} <br>
      <b>Voiceover Script:</b> ${userData.voiceover_script} <br>
      <b>Image Prompt:</b> ${userData.image_prompt} <br>
      <b>Status:</b> ${userData.status}
    `;
  } else {
    resultDiv.innerText = "No result found for your account.";
  }
});

// ========================
// Auto-refresh every 10s
// ========================
setInterval(() => {
  const currentUser = auth.currentUser;
  if (!currentUser) return; // Only refresh if logged in
  document.getElementById("checkResultBtn").click();
}, 10000);


        



</script>

</body>
</html>
